<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boleta de Venta – Generador</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { background:#e5e7eb; }
    .paper { width:210mm; min-height:297mm; margin:auto; background:white; box-shadow:0 0 5px rgba(0,0,0,.2); }
    .content { padding:20mm 15mm; font-family: Arial, Helvetica, sans-serif; font-size:12px; color:#111827; }
    .header { display:flex; justify-content:space-between; align-items:flex-start; border-bottom:1px solid #cbd5e1; padding-bottom:8px; }
    .header h1 { font-size:18px; margin:0; }
    .header p { font-size:10px; margin:2px 0; color:#475569; }
    .logo-box { border:1px solid #cbd5e1; padding:4px; display:flex; align-items:center; justify-content:center; }
    .logo-box img { max-height:40px; object-fit:contain; }
    table { width:100%; border-collapse:collapse; margin-top:16px; }
    th, td { border:1px solid #94a3b8; padding:6px 8px; font-size:11px; }
    th { background:#f1f5f9; text-align:left; color:#334155; }
    .totals { display:flex; justify-content:space-between; align-items:center; margin-top:12px; }
    .totals-box { border:1px solid #cbd5e1; background:#f8fafc; padding:8px 24px; text-align:right; }
    .totals-box div:first-child { font-size:10px; color:#475569; }
    .totals-box div:last-child { font-size:14px; font-weight:bold; }
    .footer-note { font-size:10px; margin-top:16px; }
  </style>
</head>
<body>
  <div class="max-w-6xl mx-auto p-4 grid gap-4 md:grid-cols-[1fr_1fr]">
    <section class="bg-white shadow rounded p-4">
      <h2 class="font-semibold mb-2">Formulario de datos</h2>
      <div class="grid grid-cols-2 gap-2 text-sm">
        <label class="col-span-2">Cliente<input id="nombre" class="w-full border rounded px-2 py-1" /></label>
        <label>IMEI 1<input id="imei1" class="w-full border rounded px-2 py-1" /></label>
        <label>IMEI 2<input id="imei2" class="w-full border rounded px-2 py-1" /></label>
        <label class="col-span-2">Descripción<input id="descripcion" class="w-full border rounded px-2 py-1" value="HONOR MAGIC7 LITE 8GB 256GB"/></label>
        <label>Código<input id="codigo" class="w-full border rounded px-2 py-1" value="HONOR - ALI-NX3"/></label>
        <label>Color<input id="color" class="w-full border rounded px-2 py-1" value="UNKNOWN"/></label>
        <label class="col-span-2">Monto<input id="monto" class="w-full border rounded px-2 py-1" value="Col$ 2,300.00"/></label>
        <label>Fecha<input id="fecha" type="date" class="w-full border rounded px-2 py-1"/></label>
        <label>Vendedor<input id="vendedor" class="w-full border rounded px-2 py-1" value="Vannia Luheme"/></label>
      </div>
      <div class="mt-3 flex gap-2">
        <button id="btn-preview" class="px-3 py-1 rounded bg-slate-700 text-white">Vista previa</button>
        <button id="btn-pdf" class="px-3 py-1 rounded bg-indigo-600 text-white">Generar PDF A4</button>
      </div>
    </section>

    <section class="paper">
      <div class="content" id="preview">
        <p class="text-slate-500">Completa el formulario y pulsa Vista previa</p>
      </div>
    </section>
  </div>

<script>
const $ = id => document.getElementById(id);
const fmtDate = s => new Intl.DateTimeFormat('es-PE', { dateStyle:'medium'}).format(new Date(s));
const DEFAULT_LOGO = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAX0AA... (base64 truncado)"; // se reemplaza con logo base64

function nf(){ return 'ADVT - ' + Math.floor(1000+Math.random()*9000); }

function data(){
  return {
    nombre: $('nombre').value||'—',
    imei1: $('imei1').value,
    imei2: $('imei2').value,
    descripcion: $('descripcion').value,
    codigo: $('codigo').value,
    color: $('color').value,
    monto: $('monto').value,
    fecha: $('fecha').value||new Date().toISOString().slice(0,10),
    vendedor: $('vendedor').value||'—'
  };
}

function plantilla(d, nro){
  return `
  <div>
    <div class="header">
      <div>
        <h1>MeGa Tienda Virtual 77</h1>
        <p>Bogotá - Colombia • finanzas@megatiendavirtual77.com.co</p>
      </div>
      <div class="logo-box"><img src="${DEFAULT_LOGO}"/></div>
    </div>
    <div style="display:flex; justify-content:space-between; margin-top:10px;">
      <div>
        <p><b>BOLETA DE VENTA</b></p>
        <p>N°. ${nro}</p>
      </div>
      <div style="text-align:right">
        <p>Fecha y hora de Factura<br>${fmtDate(d.fecha)}</p>
        <p>Vendedor<br>${d.vendedor}</p>
      </div>
    </div>
    <p style="margin-top:8px;">Cliente: ${d.nombre}</p>

    <table>
      <thead><tr><th>ÍTEM</th><th>DESCRIPCIÓN</th><th>CÓDIGO</th><th>COLOR</th><th>IMEI</th><th style="text-align:right">TOTAL</th></tr></thead>
      <tbody><tr>
        <td>1</td>
        <td>${d.descripcion}</td>
        <td>${d.codigo}</td>
        <td>${d.color}</td>
        <td>${[d.imei1,d.imei2].filter(Boolean).join(' / ')}</td>
        <td style="text-align:right">${d.monto}</td>
      </tr></tbody>
    </table>

    <div class="totals">
      <p><b>TOTAL ITEMS: 01</b></p>
      <div class="totals-box">
        <div>TOTAL A PAGAR</div>
        <div>${d.monto}</div>
      </div>
    </div>

    <p class="footer-note">Pago: Se realiza pago en efectivo</p>
  </div>`;
}

function preview(){
  const d=data();
  const nro=nf();
  const el=$('preview');
  el.innerHTML=plantilla(d,nro);
  el.dataset.nro=nro;
}

$('btn-preview').addEventListener('click',preview);

$('btn-pdf').addEventListener('click',()=>{
  const d=data();
  const nro=$('preview').dataset.nro||nf();
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF({unit:'pt',format:'a4'});
  const M=50; let y=M;
  doc.addImage(DEFAULT_LOGO,'PNG',doc.internal.pageSize.getWidth()-M-120,y-10,120,40);
  doc.setFontSize(14).setFont('helvetica','bold').text('MeGa Tienda Virtual 77',M,y+15);
  doc.setFontSize(10).setFont('helvetica','normal').text('Bogotá - Colombia • finanzas@megatiendavirtual77.com.co',M,y+30);
  y+=60;
  doc.setFont('helvetica','bold').text('BOLETA DE VENTA',M,y);
  doc.setFont('helvetica','normal').text('N°. '+nro,M,y+15);
  doc.text('Fecha y hora de Factura: '+fmtDate(d.fecha),M,y+30);
  doc.text('Vendedor: '+d.vendedor,M,y+45);
  y+=70;
  doc.text('Cliente: '+d.nombre,M,y);
  y+=10;
  doc.autoTable({startY:y+10,margin:{left:M,right:M},head:[['ÍTEM','DESCRIPCIÓN','CÓDIGO','COLOR','IMEI','TOTAL']],body:[[ '1',d.descripcion,d.codigo,d.color,[d.imei1,d.imei2].filter(Boolean).join(' / '),d.monto]],styles:{fontSize:10},headStyles:{fillColor:[241,245,249],textColor:[51,65,85]},columnStyles:{0:{cellWidth:40},1:{cellWidth:160},2:{cellWidth:100},3:{cellWidth:80},4:{cellWidth:140},5:{cellWidth:70,halign:'right'}}});
  y=doc.lastAutoTable.finalY+20;
  doc.text('TOTAL ITEMS: 01',M,y);
  const boxW=190,boxH=50,pageW=doc.internal.pageSize.getWidth();
  doc.setDrawColor(160).setFillColor(248,250,252).roundedRect(pageW-M-boxW,y-20,boxW,boxH,6,6,'FD');
  doc.setFontSize(10).setTextColor(100).text('TOTAL A PAGAR',pageW-M-boxW+12,y-2);
  doc.setFontSize(14).setFont('helvetica','bold').setTextColor(0).text(d.monto,pageW-M-12,y+15,{align:'right'});
  doc.setFontSize(10).setFont('helvetica','normal').text('Pago: Se realiza pago en efectivo',M,y+40);
  doc.save('boleta_'+nro+'.pdf');
});

document.addEventListener('DOMContentLoaded',()=>{ $('fecha').value=new Date().toISOString().slice(0,10); preview(); });
</script>
</body>
</html>
